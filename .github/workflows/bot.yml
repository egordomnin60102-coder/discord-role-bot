name: Discord Bot

on:
  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
  workflow_dispatch:
  
  # –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 5 —á–∞—Å–æ–≤ 50 –º–∏–Ω—É—Ç
  schedule:
    - cron: '50 */6 * * *'
  
  # –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞
  push:
    branches: [ main ]

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6 —á–∞—Å–æ–≤ –º–∞–∫—Å–∏–º—É–º
    
    steps:
    - name: üì• Checkout repository
      uses: actions/checkout@v4
      
    - name: ‚öôÔ∏è Setup .NET 8
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
        
    - name: üî® Build bot
      run: |
        echo "Building Discord bot..."
        dotnet build ./bot/bot.csproj -c Release
        
    - name: ü§ñ Run Discord Bot
      env:
        DISCORD_TOKEN: ${{ secrets.DISCORD_TOKEN }}
      run: |
        echo "üöÄ Starting Discord Bot on GitHub Actions..."
        echo "Bot will run for 5 hours 45 minutes (GitHub limit)"
        
        # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –±–æ—Ç–∞
        cd ./bot
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –Ω–∞ 5 —á–∞—Å–æ–≤ 45 –º–∏–Ω—É—Ç
        timeout 345m dotnet run --configuration Release
        
        echo "‚è∞ Time's up! Bot will restart in 15 minutes via schedule"
        
    - name: üìù Log completion
      if: always()
      run: |
        echo "‚úÖ Workflow completed at $(date)"
