name: Discord Bot

on:
  # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
  workflow_dispatch:
  
  # –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 5 —á–∞—Å–æ–≤ 50 –º–∏–Ω—É—Ç
  schedule:
    - cron: '50 */6 * * *'
  
  # –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞
  push:
    branches: [ main ]

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6 —á–∞—Å–æ–≤ –º–∞–∫—Å–∏–º—É–º
    
    steps:
    - name: üì• Checkout repository
      uses: actions/checkout@v4
      
    - name: ‚öôÔ∏è Setup .NET 8
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
        
    - name: üî® Build bot
      run: |
        echo "Building Discord bot..."
        dotnet build ./bot/bot.csproj -c Release
        
    - name: ü§ñ Run Discord Bot
      env:
        DISCORD_TOKEN: ${{ secrets.DISCORD_TOKEN }}
      run: |
        echo "üöÄ Starting Discord Bot on GitHub Actions..."
        echo "Bot will run for 5 hours 45 minutes (GitHub limit)"
        
        # –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –∏–∑ –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
        cd ./bot
        timeout 345m dotnet run --configuration Release
        
        # –ò–õ–ò –í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—É—Ç–∏ –∫ –ø—Ä–æ–µ–∫—Ç—É (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
        # timeout 345m dotnet run --project ./bot/bot.csproj --configuration Release
        
        echo "‚è∞ Time's up! Bot will restart in 15 minutes via schedule"
        
    - name: üìù Log completion
      if: always()
      run: |
        echo "‚úÖ Workflow completed at $(date)"
