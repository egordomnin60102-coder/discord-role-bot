name: Discord Music Bot

on:
  workflow_dispatch:
  schedule:
    - cron: '50 */6 * * *'
  push:
    branches: [ main ]

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: ğŸµ Install FFmpeg and yt-dlp
      run: |
        sudo apt update
        sudo apt install -y ffmpeg python3-pip
        pip3 install yt-dlp
        
    - name: âš™ï¸ Setup .NET 8
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
        
    - name: ğŸ”¨ Build bot
      run: |
        echo "Building Discord music bot..."
        dotnet restore ./bot/bot.csproj
        dotnet build ./bot/bot.csproj -c Release --no-restore
        
    - name: ğŸ¤– Run Discord Music Bot
      env:
        DISCORD_TOKEN: ${{ secrets.DISCORD_TOKEN }}
      run: |
        echo "ğŸš€ Starting Discord Music Bot on GitHub Actions..."
        cd ./bot
        timeout 345m dotnet run --configuration Release --no-build
        echo "â° Time's up! Bot will restart in 15 minutes via schedule"
        
    - name: ğŸ“ Log completion
      if: always()
      run: |
        echo "âœ… Workflow completed at $(date)"
